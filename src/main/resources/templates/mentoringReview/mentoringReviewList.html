<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>멘토링 후기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* 기본 레이아웃 스타일 */
        body {
            background-color: #f7faff;
            margin: 0;
        }

        /* 사이드바 스타일 */
        .sidebar {
            width: 220px;
            height: 100vh;
            background-color: #29459A;
            position: fixed;
            top: 0;
            left: 0;
            padding-top: 40px;
        }

        .sidebar a {
            display: block;
            padding: 15px 25px;
            text-decoration: none;
            color: white;
            font-weight: 500;
        }

        .sidebar a.active,
        .sidebar a:hover {
            background-color: white;
            color: #29459A;
        }

        /* 메인 영역 */
        .content {
            margin-left: 220px;
            padding: 40px 20px;
            min-height: 100vh;
        }

        /* 테이블 헤더 스타일 */
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            border: none;
            padding: 12px;
            white-space: nowrap;
        }

        /* 테이블 셀 스타일 */
        .table td {
            padding: 12px;
            border: none;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
            white-space: nowrap;
        }

        /* 테이블 행 호버 효과 */
        .table tbody tr:hover {
            background-color: #f0f4ff;
            cursor: pointer;
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        /* 별점 표시 스타일 */
        .star-rating {
            color: #ffc107;
            font-size: 1.1rem;
        }

        .star-rating .star {
            color: #ddd;
        }

        .star-rating .star.filled {
            color: #ffc107;
        }

        /* 제목 셀 스타일 */
        .title-cell {
            white-space: normal;
            max-width: 300px;
        }

        .review-title {
            font-weight: 500;
            color: #333;
        }
    </style>
</head>
<body>

<!-- 사이드바 네비게이션 -->
<div class="sidebar">
    <div class="menu">
        <a href="/mentoring">멘토링 신청</a>
        <a href="/mentoringReview" class="active">멘토링 후기</a>
        <a href="/study">스터디 만들기</a>
        <a href="/board">자유게시판</a>
    </div>
</div>

<!-- 메인 콘텐츠 -->
<div class="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>멘토링 후기</h3>
        <div class="d-flex gap-2">
            <a href="/mentoringReview/write" class="btn btn-outline-primary">후기 작성하기</a>
        </div>
    </div>

    <div id="review-content">
        <!-- 후기 목록 테이블 -->
        <div class="card">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th style="width: 60px;">번호</th>
                    <th style="width: 100px;">글쓴이</th>
                    <th style="width: 100px;">멘토명</th>
                    <th style="width: 350px;">제목</th>
                    <th style="width: 100px;">평점</th>
                    <th style="width: 70px;">조회수</th>
                    <th style="width: 110px;">작성일</th>
                </tr>
                </thead>
                <tbody id="reviewTableBody">
                <!-- 초기 로딩 상태 표시 -->
                <tr>
                    <td colspan="7" class="text-center">
                        <div class="spinner-border spinner-border-sm me-2"></div>
                        로딩 중...
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 페이지 로드 시 후기 목록 불러오기
    document.addEventListener('DOMContentLoaded', () => {
        loadReviews();
    });

    // 서버에서 후기 목록을 가져와서 화면에 표시
    function loadReviews() {
        const tbody = document.getElementById('reviewTableBody');

        // 로딩 상태 표시
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center">
                    <div class="spinner-border spinner-border-sm me-2"></div>
                    로딩 중...
                </td>
            </tr>
        `;

        fetch('/api/mentoring-review')
            .then(res => res.json())
            .then(data => {
                tbody.innerHTML = '';

                if (data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                아직 작성된 후기가 없습니다.
                            </td>
                        </tr>
                    `;
                    return;
                }

                // 후기 데이터를 테이블 행으로 변환
                data.forEach((review, index) => {
                    const stars = generateStarRating(review.rating);

                    const row = document.createElement('tr');
                    row.style.cursor = 'pointer';
                    row.onclick = () => viewReview(review.id);

                    // 테이블 행 HTML 구성
                    row.innerHTML = `
                        <td class="text-center">${data.length - index}</td>
                        <td>${review.reviewerName}</td>
                        <td>${review.mentorName}</td>
                        <td class="title-cell">
                            <div class="review-title">${review.title}</div>
                        </td>
                        <td>
                            <div class="star-rating">${stars}</div>
                        </td>
                        <td class="text-center">${review.viewCount}</td>
                        <td>${formatDate(review.createdAt)}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(err => {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-danger">
                            오류 발생: ${err.message}
                        </td>
                    </tr>
                `;
            });
    }

    // 별점을 별 모양 HTML로 변환하는 함수
    function generateStarRating(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                // 채워진 별
                stars += '<span class="star filled">★</span>';
            } else {
                // 빈 별
                stars += '<span class="star">★</span>';
            }
        }
        return stars;
    }

    // 날짜를 MM/DD 형식으로 포맷
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR', {
            month: '2-digit',
            day: '2-digit'
        });
    }

    // 후기 상세보기 페이지로 이동
    function viewReview(reviewId) {
        window.location.href = `/mentoringReview/detail?id=${reviewId}`;
    }
</script>
</body>
</html>