<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>멘토링 후기 상세보기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* 기본 레이아웃 스타일 */
        body {
            background-color: #f7faff;
            margin: 0;
        }

        /* 사이드바 스타일 */
        .sidebar {
            width: 220px;
            height: 100vh;
            background-color: #29459A;
            position: fixed;
            top: 0;
            left: 0;
            padding-top: 40px;
        }

        .sidebar a {
            display: block;
            padding: 15px 25px;
            text-decoration: none;
            color: white;
            font-weight: 500;
        }

        .sidebar a.active,
        .sidebar a:hover {
            background-color: white;
            color: #29459A;
        }

        /* 메인 콘텐츠 영역 */
        .content {
            margin-left: 220px;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .detail-container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* 별점 표시 스타일 */
        .star-rating {
            color: #ffc107;
            font-size: 1.2rem;
        }

        .star-rating .star {
            color: #ddd;
        }

        .star-rating .star.filled {
            color: #ffc107;
        }

        /* 후기 내용 스타일 */
        .review-content {
            line-height: 1.6;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<!-- 사이드바 네비게이션 -->
<div class="sidebar">
    <div class="menu">
        <a href="/mentoring">멘토링 신청</a>
        <a href="/mentoringReview" class="active">멘토링 후기</a>
        <a href="/study">스터디 만들기</a>
        <a href="/board">자유게시판</a>
    </div>
</div>

<!-- 메인 콘텐츠 -->
<div class="content">
    <div class="detail-container">
        <!-- 뒤로가기 버튼 -->
        <div class="mb-3">
            <button type="button" class="btn btn-outline-secondary" onclick="goBack()">
                ← 목록으로 돌아가기
            </button>
        </div>

        <!-- 로딩 상태 표시 -->
        <div id="loadingState" class="text-center py-5">
            <div class="spinner-border text-primary mb-3"></div>
            <div>후기를 불러오는 중...</div>
        </div>

        <!-- 에러 상태 표시 -->
        <div id="errorState" class="text-center py-5 text-danger" style="display: none;">
            <div class="mb-3">오류 발생</div>
            <div id="errorMessage">후기를 불러올 수 없습니다.</div>
            <button class="btn btn-primary mt-3" onclick="loadReviewDetail()">다시 시도</button>
        </div>

        <!-- 후기 상세 내용 -->
        <div id="reviewDetail" style="display: none;">
            <div class="card">
                <!-- 제목, 작성자, 멘토, 별점 정보 -->
                <div class="card-header">
                    <h4 class="mb-3" id="reviewTitle"></h4>
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div>
                            <small class="text-muted">작성자: <span id="reviewerName"></span></small><br>
                            <small class="text-muted">멘토: <span id="mentorName"></span></small>
                        </div>
                        <div class="text-end">
                            <div class="star-rating" id="starRating"></div>
                            <small id="ratingText"></small>
                        </div>
                    </div>
                </div>

                <!-- 후기 본문 내용 -->
                <div class="card-body">
                    <div class="review-content" id="reviewContent"></div>
                </div>

                <!-- 후기 푸터 - 작성일, 조회수, 버튼들 -->
                <div class="card-footer bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted">
                                작성일: <span id="createdAt"></span> |
                                조회수: <span id="viewCount"></span>회
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 후기 ID 추출
    const urlParams = new URLSearchParams(window.location.search);
    const reviewId = urlParams.get('id');

    // 페이지 로드 시 실행
    document.addEventListener('DOMContentLoaded', function() {
        if (!reviewId) {
            showError('잘못된 접근입니다.');
            return;
        }
        loadReviewDetail();
    });

    // 후기 상세 정보를 가져오기
    function loadReviewDetail() {
        showLoading();

        fetch(`/api/mentoring-review/${reviewId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('후기를 찾을 수 없습니다.');
                }
                return response.json();
            })
            .then(review => {
                displayReview(review);
            })
            .catch(error => {
                showError(error.message);
            });
    }

    // 받아온 후기 데이터 화면에 표시
    function displayReview(review) {

        document.getElementById('reviewTitle').textContent = review.title;
        document.getElementById('reviewerName').textContent = review.reviewerName;
        document.getElementById('mentorName').textContent = review.mentorName;
        document.getElementById('createdAt').textContent = formatDate(review.createdAt);
        document.getElementById('viewCount').textContent = review.viewCount;
        document.getElementById('reviewContent').textContent = review.content;

        // 별점 표시
        const starRating = document.getElementById('starRating');
        const ratingText = document.getElementById('ratingText');

        starRating.innerHTML = generateStarRating(review.rating);
        ratingText.textContent = `${review.rating}점`;

        // 로딩 화면 숨기고 내용 보여주기
        hideLoading();
        document.getElementById('reviewDetail').style.display = 'block';
    }

    // 별점을 HTML로 생성하는 함수
    function generateStarRating(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                stars += '<span class="star filled">★</span>';
            } else {
                stars += '<span class="star">★</span>';
            }
        }
        return stars;
    }

    // 날짜 형식을 한국어로 변환
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR');
    }

    // 로딩 상태를 보여주는 함수
    function showLoading() {
        document.getElementById('loadingState').style.display = 'block';
        document.getElementById('errorState').style.display = 'none';
        document.getElementById('reviewDetail').style.display = 'none';
    }

    // 로딩 상태를 숨기는 함수
    function hideLoading() {
        document.getElementById('loadingState').style.display = 'none';
    }

    // 에러 상태를 보여주는 함수
    function showError(message) {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'block';
        document.getElementById('reviewDetail').style.display = 'none';
        document.getElementById('errorMessage').textContent = message;
    }

    // 목록으로 돌아가기
    function goBack() {
        window.history.back();
    }
</script>
</body>
</html>