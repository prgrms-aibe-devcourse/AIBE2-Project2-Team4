<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layouts/layout}">

<!-- ì˜¬ë°”ë¥¸ HTML êµ¬ì¡°ë¡œ ì‘ì„± -->

<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
<div layout:fragment="content">
    <div class="main">
        <div class="dashboard-header">ëŒ€ì‹œë³´ë“œ</div>

        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-title">ğŸ‘¥ ì‹ ê·œ íšŒì› ìˆ˜</div>
                    <div class="card-content">
                        <canvas id="newUserChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <div class="card-title">ğŸ‘¥ íƒˆí‡´ íšŒì› ìˆ˜</div>
                    <div class="card-content">
                        <canvas id="leftUserChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" style="margin-top:2rem;">
            <div class="col">
                <div class="card">
                    <div class="card-title">ğŸ“ ë¯¸ì²˜ë¦¬ ì‹ ê³  ìˆ˜</div>
                    <div class="card-content">100ê±´</div>
                    <a href="#" class="card-small-link">ì²˜ë¦¬í•˜ëŸ¬ ê°€ê¸° â–¶</a>
                </div>
            </div>
            <div class="col">
                <div class="card">
                    <div class="card-title">ğŸ¤ ë§¤ì¹­ í˜„í™©</div>
                    <div class="card-content">
                        <canvas id="matchingChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JS ì½”ë“œ -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ctx = document.getElementById('newUserChart').getContext('2d');

            const today = new Date();
            const start = new Date();
            start.setDate(today.getDate() - 6);

            const formatDate = (d) => d.toISOString().split('T')[0];

            fetch(`/admin/api/dashboard/signup-stats?start=${formatDate(start)}&end=${formatDate(today)}`)
                .then(res => res.json())
                .then(data => {
                    const labels = data.map(item => item.date);
                    const counts = data.map(item => item.count);

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'ì¼ë³„ ì‹ ê·œ ê°€ì…ì ìˆ˜',
                                data: counts,
                                borderColor: '#4e73df',
                                backgroundColor: 'rgba(78, 115, 223, 0.1)',
                                fill: true,
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: true },
                                tooltip: { mode: 'index', intersect: false }
                            },
                            scales: {
                                x: { title: { display: true, text: 'ë‚ ì§œ' }},
                                y: { beginAtZero: true,
                                    title: { display: true, text: 'ê°€ì…ì ìˆ˜' },
                                    ticks: {
                                        precision: 0
                                    }
                                }
                            }
                        }
                    });
                });
        });
    </script>
</div>
</body>

</html>
