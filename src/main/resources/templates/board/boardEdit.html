<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>게시글 수정</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body {
            padding: 40px;
            font-family: 'Pretendard', sans-serif;
            background-color: #f7faff;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            max-width: 700px;
        }
    </style>
</head>
<body>
<div class="container">
    <h3>게시글 수정</h3>
    <form id="editForm">
        <div class="mb-3">
            <label class="form-label">제목</label>
            <input type="text" class="form-control" id="title" name="title" required>
        </div>
        <div class="mb-3">
            <label class="form-label">내용</label>
            <textarea class="form-control" id="content" name="content" rows="6" required></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">직종</label>
            <select class="form-select" id="jobType" name="jobType" required>
                <option value="">선택하세요</option>
                <option value="백엔드">백엔드</option>
                <option value="프론트엔드">프론트엔드</option>
                <option value="디자이너">디자이너</option>
                <option value="기획자">기획자</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">기술스택</label>
            <select class="form-select" id="techStack" name="techStack" required>
                <option selected disabled>직종을 먼저 선택해 주세요</option>
            </select>
        </div>
        <div class="d-flex justify-content-end">
            <a href="/board" class="btn btn-secondary me-2">취소</a>
            <button type="submit" class="btn btn-primary">수정완료</button>
        </div>
    </form>
</div>

<script>
    const techOptions = {
        "백엔드": ["Java", "Spring", "Spring Boot", "Node.js", "Express", "Python", "Django", "MySQL", "MongoDB"],
        "프론트엔드": ["HTML", "CSS", "JavaScript", "React", "Vue", "TypeScript", "Next.js"],
        "디자이너": ["Figma", "Photoshop", "Illustrator", "Sketch", "Adobe XD"],
        "기획자": ["Notion", "Jira", "Confluence", "Trello", "Excel"]
    };

    const boardId = window.location.pathname.split("/").pop();

    $(document).ready(function () {
        // 초기 데이터 불러오기
        $.ajax({
            url: `/api/board/${boardId}`,
            type: 'GET',
            success: function (data) {
                $('#title').val(data.title);
                $('#content').val(data.content);
                $('#jobType').val(data.jobType);
                updateTechStack(data.jobType, data.techStack);
            }
        });

        $('#jobType').on('change', function () {
            updateTechStack(this.value, null);
        });

        $('#editForm').on('submit', function (e) {
            e.preventDefault();

            const payload = {
                title: $('#title').val(),
                content: $('#content').val(),
                jobType: $('#jobType').val(),
                techStack: $('#techStack').val()
            };

            $.ajax({
                url: `/api/board/${boardId}`,
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(payload),
                success: function () {
                    alert('수정이 완료되었습니다.');
                    location.href = `/board/${boardId}`;
                },
                error: function () {
                    alert('수정에 실패했습니다.');
                }
            });
        });
    });

    function updateTechStack(selectedJob, selectedTech) {
        const techSelect = $('#techStack');
        techSelect.empty();

        if (techOptions[selectedJob]) {
            techOptions[selectedJob].forEach(stack => {
                const option = $('<option>').val(stack).text(stack);
                if (stack === selectedTech) option.attr('selected', true);
                techSelect.append(option);
            });
        } else {
            techSelect.append('<option selected disabled>직종을 먼저 선택해 주세요</option>');
        }
    }
</script>
</body>
</html>
