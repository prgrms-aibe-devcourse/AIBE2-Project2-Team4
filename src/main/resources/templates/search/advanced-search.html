<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>고급 검색 - PortPilot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .advanced-search-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem 0;
    }
    .filter-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    .filter-section {
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .filter-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    .skill-tag {
      display: inline-block;
      background: #e3f2fd;
      color: #1976d2;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.875rem;
      margin: 0.25rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .skill-tag:hover {
      background: #1976d2;
      color: white;
    }
    .skill-tag.selected {
      background: #1976d2;
      color: white;
    }
  </style>
</head>
<body>
<!-- 헤더 컴포넌트 -->
<div th:replace="~{components/header :: header}"></div>

<!-- 고급 검색 영역 -->
<div class="advanced-search-container">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="text-center mb-4">
          <h1 class="display-4 fw-bold mb-3">
            <i class="fas fa-sliders-h me-3"></i>고급 검색
          </h1>
          <p class="lead">세부 조건을 설정하여 정확한 구직자를 찾아보세요</p>
        </div>

        <div class="filter-card p-4">
          <form th:action="@{/search/users/advanced}" method="get" th:object="${filterDto}">

            <!-- 기본 검색 조건 -->
            <div class="filter-section">
              <h5 class="text-dark fw-bold mb-3">
                <i class="fas fa-search me-2"></i>기본 검색 조건
              </h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="keyword" class="form-label text-dark">키워드</label>
                  <input type="text" class="form-control" id="keyword"
                         th:field="*{keyword}" placeholder="이름, 이메일, 기술 등">
                </div>
                <div class="col-md-6">
                  <label for="location" class="form-label text-dark">지역</label>
                  <input type="text" class="form-control" id="location"
                         th:field="*{location}" placeholder="서울, 부산, 경기 등">
                </div>
              </div>
            </div>

            <!-- 기술 스택 필터 -->
            <div class="filter-section">
              <h5 class="text-dark fw-bold mb-3">
                <i class="fas fa-code me-2"></i>기술 스택
              </h5>

              <div class="mb-3">
                <label class="form-label text-dark">필수 기술</label>
                <div class="border rounded p-3 bg-light">
                  <div class="skill-tags">
                    <span class="skill-tag" data-skill="Java">Java</span>
                    <span class="skill-tag" data-skill="Python">Python</span>
                    <span class="skill-tag" data-skill="JavaScript">JavaScript</span>
                    <span class="skill-tag" data-skill="React">React</span>
                    <span class="skill-tag" data-skill="Vue.js">Vue.js</span>
                    <span class="skill-tag" data-skill="Spring">Spring</span>
                    <span class="skill-tag" data-skill="Node.js">Node.js</span>
                    <span class="skill-tag" data-skill="MySQL">MySQL</span>
                    <span class="skill-tag" data-skill="PostgreSQL">PostgreSQL</span>
                    <span class="skill-tag" data-skill="MongoDB">MongoDB</span>
                  </div>
                  <input type="hidden" name="requiredSkills" id="requiredSkillsInput">
                </div>
              </div>

              <div class="row g-3">
                <div class="col-md-6">
                  <label for="skillLevel" class="form-label text-dark">기술 수준</label>
                  <select class="form-select" id="skillLevel" th:field="*{skillLevel}">
                    <option value="">선택안함</option>
                    <option value="BEGINNER">초급</option>
                    <option value="INTERMEDIATE">중급</option>
                    <option value="ADVANCED">고급</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- 경력 조건 -->
            <div class="filter-section">
              <h5 class="text-dark fw-bold mb-3">
                <i class="fas fa-briefcase me-2"></i>경력 조건
              </h5>
              <div class="row g-3">
                <div class="col-md-4">
                  <label for="minExperience" class="form-label text-dark">최소 경력</label>
                  <select class="form-select" id="minExperience" th:field="*{minExperience}">
                    <option value="">선택안함</option>
                    <option value="0">신입</option>
                    <option value="1">1년 이상</option>
                    <option value="3">3년 이상</option>
                    <option value="5">5년 이상</option>
                    <option value="10">10년 이상</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="maxExperience" class="form-label text-dark">최대 경력</label>
                  <select class="form-select" id="maxExperience" th:field="*{maxExperience}">
                    <option value="">선택안함</option>
                    <option value="2">2년 이하</option>
                    <option value="5">5년 이하</option>
                    <option value="10">10년 이하</option>
                    <option value="15">15년 이하</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label text-dark">경력 유형</label>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="experienceTypes" value="INTERN" id="expIntern">
                    <label class="form-check-label" for="expIntern">인턴</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="experienceTypes" value="JUNIOR" id="expJunior">
                    <label class="form-check-label" for="expJunior">주니어</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="experienceTypes" value="SENIOR" id="expSenior">
                    <label class="form-check-label" for="expSenior">시니어</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- 학력 조건 -->
            <div class="filter-section">
              <h5 class="text-dark fw-bold mb-3">
                <i class="fas fa-graduation-cap me-2"></i>학력 조건
              </h5>
              <div class="row g-3">
                <div class="col-md-4">
                  <label for="education" class="form-label text-dark">최소 학력</label>
                  <select class="form-select" id="education" th:field="*{education}">
                    <option value="">선택안함</option>
                    <option value="고등학교">고등학교 졸업</option>
                    <option value="전문대학">전문대학 졸업</option>
                    <option value="대학교">대학교 졸업</option>
                    <option value="대학원">대학원 졸업</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="graduationStatus" class="form-label text-dark">졸업 상태</label>
                  <select class="form-select" id="graduationStatus" th:field="*{graduationStatus}">
                    <option value="">선택안함</option>
                    <option value="GRADUATED">졸업</option>
                    <option value="EXPECTED">졸업예정</option>
                    <option value="ENROLLED">재학중</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- 근무 조건 -->
            <div class="filter-section">
              <h5 class="text-dark fw-bold mb-3">
                <i class="fas fa-building me-2"></i>근무 조건
              </h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label text-dark">고용 형태</label>
                  <div class="row">
                    <div class="col-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="employmentTypes" value="FULL_TIME" id="fullTime">
                        <label class="form-check-label" for="fullTime">정규직</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="employmentTypes" value="PART_TIME" id="partTime">
                        <label class="form-check-label" for="partTime">파트타임</label>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="employmentTypes" value="CONTRACT" id="contract">
                        <label class="form-check-label" for="contract">계약직</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="employmentTypes" value="FREELANCE" id="freelance">
                        <label class="form-check-label" for="freelance">프리랜서</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="workLocation" class="form-label text-dark">근무 지역</label>
                    <input type="text" class="form-control" id="workLocation"
                           th:field="*{workLocation}" placeholder="선호 근무 지역">
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" th:field="*{remoteWork}" id="remoteWork">
                    <label class="form-check-label" for="remoteWork">원격 근무 가능</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- 추가 조건 -->
            <div class="filter-section">
              <h5 class="text-dark fw-bold mb-3">
                <i class="fas fa-plus-circle me-2"></i>추가 조건
              </h5>
              <div class="row g-3">
                <div class="col-md-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" th:field="*{hasPortfolio}" id="hasPortfolio">
                    <label class="form-check-label" for="hasPortfolio">포트폴리오 보유</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" th:field="*{hasCertification}" id="hasCertification">
                    <label class="form-check-label" for="hasCertification">자격증 보유</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" th:field="*{isActive}" id="isActive">
                    <label class="form-check-label" for="isActive">최근 활동</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <label for="lastLoginDays" class="form-label text-dark">최종 로그인</label>
                  <select class="form-select" id="lastLoginDays" th:field="*{lastLoginDays}">
                    <option value="">상관없음</option>
                    <option value="7">7일 이내</option>
                    <option value="30">30일 이내</option>
                    <option value="90">90일 이내</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- 정렬 및 검색 버튼 -->
            <div class="d-flex justify-content-between align-items-center">
              <div class="row g-3">
                <div class="col-auto">
                  <label for="sortBy" class="form-label text-dark">정렬 기준</label>
                  <select class="form-select" id="sortBy" name="sortBy">
                    <option value="createdAt">최신순</option>
                    <option value="name">이름순</option>
                    <option value="experience">경력순</option>
                    <option value="updated_at">업데이트순</option>
                  </select>
                </div>
                <div class="col-auto">
                  <label for="sortDirection" class="form-label text-dark">정렬 방향</label>
                  <select class="form-select" id="sortDirection" name="sortDirection">
                    <option value="desc">내림차순</option>
                    <option value="asc">오름차순</option>
                  </select>
                </div>
              </div>

              <div>
                <a th:href="@{/search/users}" class="btn btn-outline-secondary me-3">
                  <i class="fas fa-arrow-left me-2"></i>기본 검색
                </a>
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-search me-2"></i>고급 검색 실행
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 검색 결과 영역 (기본 검색과 동일한 구조) -->
<div class="container my-5" th:if="${hasResults}">
  <!-- 검색 결과는 user-search.html과 동일한 구조 사용 -->
  <!-- 여기서는 간단히 표시 -->
  <div class="alert alert-info">
    <h5>검색 결과: <span th:text="${totalResults}">0</span>명</h5>
    <p>고급 검색 조건에 맞는 구직자들입니다.</p>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // 스킬 태그 선택 기능
  document.addEventListener('DOMContentLoaded', function() {
    const skillTags = document.querySelectorAll('.skill-tag');
    const requiredSkillsInput = document.getElementById('requiredSkillsInput');
    let selectedSkills = [];

    skillTags.forEach(tag => {
      tag.addEventListener('click', function() {
        const skill = this.dataset.skill;

        if (this.classList.contains('selected')) {
          this.classList.remove('selected');
          selectedSkills = selectedSkills.filter(s => s !== skill);
        } else {
          this.classList.add('selected');
          selectedSkills.push(skill);
        }

        requiredSkillsInput.value = selectedSkills.join(',');
      });
    });
  });
</script>
</body>
</html>